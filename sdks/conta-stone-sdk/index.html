<!doctype html><html lang=pt><head><meta charset=utf-8><title>Conta Stone SDK</title><meta name=generator content="Hugo 0.69.0"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=stylesheet href=https://stone-co.github.io/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://stone-co.github.io/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=https://stone-co.github.io/plugins/highlight/hybrid.css><link rel=icon href=https://stone-co.github.io/images/favicon.png type=image/x-icon><link href=../../assets/css/circular.css rel=stylesheet><style>:root{--primary-color:#14aa4b;--body-color:#f8f9fd;--text-color:#677481;--text-color-dark:#5a6872;--white-color:#ffffff;--light-color:#f4f4f9;--font-family:'Circular'}</style><link href=https://stone-co.github.io/css/style.min.css rel=stylesheet media=screen><script src=https://stone-co.github.io/plugins/jquery/jquery-1.12.4.js></script><script src=https://stone-co.github.io/plugins/jquery/jquery-ui.js></script><script src=https://stone-co.github.io/plugins/bootstrap/bootstrap.min.js></script><script src=https://stone-co.github.io/plugins/match-height/jquery.matchHeight-min.js></script><script src=https://stone-co.github.io/plugins/highlight/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></head><body><header class="shadow-bottom sticky-top bg-white"><nav class="navbar navbar-expand-md navbar-light"><div class=container><a class="navbar-brand px-2" href=/><img class=img-fluid src=https://stone-co.github.io/stoneg.png alt="Stone OpenBank"></a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation aria-controls=navigation aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class="nav-link text-dark" href=/></a></li><li class=nav-item><a class="nav-link text-dark" href=https://docs.openbank.stone.com.br/reference>Referência da API</a></li><li class=nav-item><a class="nav-link text-dark" href=/guias>Guias</a></li><li class=nav-item><a class="nav-link text-dark" href="https://app.pipefy.com/public/form/Qz4ptt_W?origem_do_lead=Formul%C3%A1rio%20comercial%20documenta%C3%A7%C3%A3o">Quero ser parceiro</a></li></ul></div></div></nav></header><section class="single section-sm pb-0"><div class=container><div class=row><div class=col-lg-3><div class="bg-white pl-lg-4 py-4 pr-4 mb-5 mb-lg-0 sticky-top top-100 overflow-hidden"><ul class=list-styled><a class="d-block h4 back-btn" href=/></a><li data-nav-id=https://stone-co.github.io/sdks/ title=SDKs class=sidelist><a href=https://stone-co.github.io/sdks/>SDKs</a><ul><li data-nav-id=https://stone-co.github.io/sdks/conta-stone-sdk/ title="Conta Stone SDK" class="sidelist
active"><a href=https://stone-co.github.io/sdks/conta-stone-sdk/>Conta Stone SDK</a></li><li data-nav-id=https://stone-co.github.io/sdks/elixir/ title=Elixir class=sidelist><a href=https://stone-co.github.io/sdks/elixir/>Elixir</a></li><li data-nav-id=https://stone-co.github.io/sdks/go/ title=Go class=sidelist><a href=https://stone-co.github.io/sdks/go/>Go</a></li><li data-nav-id=https://stone-co.github.io/sdks/dotnet/ title=.Net class=sidelist><a href=https://stone-co.github.io/sdks/dotnet/>.Net</a></li></ul></li></ul></div></div><div class=col-lg-9><div class="p-lg-5 p-4 bg-white"><h2 class=mb-5>Conta Stone SDK</h2><div class=content><p>Sejam bem-vindos à documentação da Conta Stone SDK. Através da Conta Stone SDK é possível fazer o processo de abertura de conta e login no Stone OpenBank.</p><h4 id=introdução>Introdução</h4><p>A Conta Stone SDK é o ponto de entrada para acesso às nossas SDKs de autenticação (Auth SDK), aprovação (Approver SDK) e verificação de <a href=https://en.wikipedia.org/wiki/Know_your_customer>KYC</a> (<em>Know your costumer</em>)(Pegasus SDK). Segue abaixo um diagrama de como funciona a comunicação entre esses três atores.</p><figure><img src=conta-stone-sdk-diagrama.jpg alt="Diagrama Conta Stone SDK"></figure><ul><li><p>Auth SDK - responsável por executar todo o processo de autenticação seguindo as diretrizes do <a href=https://oauth.net/2/>oAuth2</a>.</p></li><li><p>Approver SDK - realiza todo o processo de aprovação e rejeição de transações.</p></li><li><p>Pegasus SDK - SDK de KYC, responsável por capturar as informações da usuária que está realizando cadastro na conta.</p></li></ul><h4 id=como-integrar-com-a-sdk>Como integrar com a SDK</h4><p>Antes de começar a integração é necessário obter uma chave de acesso ao nosso repositório. Para obter esta chave, entre em contato com a gente.</p><p>No arquivo <code>build.gradle</code> do projeto, adicione a URL do repositório.</p><pre><code class=language-json5 data-lang=json5>maven { url &quot;https://packagecloud.io/priv/${access-key}/Stone/stoneid/maven2&quot;}
</code></pre><p>Importe a dependência da Conta Stone SDK</p><pre><code class=language-json5 data-lang=json5>implementation &amp;apos;co.stone:conta:${latest_version}&amp;apos;
</code></pre><p>Sincronize o projeto e pronto! Já é possível utilizar a conta-stone-sdk.</p><h4 id=inicializando-a-sdk>Inicializando a SDK</h4><p>Uma vez que a dependência foi importada o passo seguinte da integração é inicializar a SDK no seu app, para isso é necessário especificar os parâmetros abaixo.</p><pre><code class=language-json5 data-lang=json5>ContaStone.initialize(
            application = applicationContext,
            environment = Environment.Production,
            appInfo = AppInfo(
                name = &quot;Conta Stone Android&quot;,
                version = BuildConfig.VERSION_NAME,
                buildId = BuildConfig.BUILD_ID
            ),
            clientId = &quot;client_id&quot;,
            redirectUri = URI(&quot;br.com.stone.openbank.example:/oauth2redirect&quot;),
            authFlowUIConfig = AuthFlowUIConfig(R.style.AppTheme),
            httpClientConfig = HttpClientConfig(interceptors = emptyList()),
            tokenKeyMasterUri =  URI(&quot;android-keystore://my-app&quot;),
            userBlockedActions = UserBlockedIntentConfig(
                uriLogout = &quot;myapp://mobile.example.logout&quot;,
                uriChat = &quot;myapp://mobile.example.chat&quot;
            )
        )
</code></pre><p><code>application</code>: Trata-se da instância do Application do seu app.</p><p><code>environment</code>: Existem 3 ambientes para os quais a sdk pode apontar: <code>Homolog</code>, <code>Sandbox</code> e <code>Production</code>.</p><p><code>appInfo</code>: Informações referentes ao app como nome, versão e build.</p><p><code>client_id</code>: Identificador fornecido pelo time de suporte OpenBank.</p><p><code>redirect_uri</code>: URL de redirecionamento para o app.</p><p><code>authFlowUIConfig</code>: Com esta configuração é possível passar o tema da sua aplicação para a SDK. Assim, as cores principais do estilo do seu app serão aplicadas nas telas internas da SDK.</p><p><code>httpClientConfig</code>: Trata-se de configurações HTTP customizadas, como <code>interceptors</code>, <code>connectionTimeoutMs</code>, <code>readTimeoutMs</code>, <code>writeTimeoutMs</code>, <code>networkInterceptors</code>.</p><p><code>tokenKeyMasterUri</code>: Uma URI para a chave-mestra no formato <code>android-keystore://</code>. Essa chave será utilizada para acessar o Keystore do android e salvar o token da usuária de forma segura.</p><p><code>userBlockedActions</code>: Se uma determinada usuária errar a senha de 6 dígitos mais de x vezes, ela será temporariamente bloqueada. Neste momento será exibida uma tela com duas opções: acesso ao canal de relacionamento ou fazer logout. Ao escolher entre elas, a usuária é redirecionada de volta para o app, através dessas duas URIs.</p><p>Para mais detalhes sobre como configurar deep link no seu app, clique <a href=https://developer.android.com/training/app-links/deep-linking>aqui</a>.</p><h4 id=autenticação-e-verificação-de-kyc>Autenticação e verificação de KYC</h4><p>Para iniciar o fluxo é necessário seguir o método abaixo:</p><pre><code class=language-json5 data-lang=json5>fun startAuthAndVerificationFlowForResult(
        activity: Activity,
        requestCode: Int,
        request: AuthFlowRequest,
        params: VerificationParams
    )
</code></pre><p>O atributo <code>request</code> refere-se a informações customizadas para o login, como os <code>scopes</code>. Tais recursos estarão disponíveis para a usuária ao chamar algum dos endpoints do serviço. Já o <code>loginHint</code> salva o email da usuária e é usado para preencher o username na tela de login.</p><p>O atributo <code>params</code> recebe comandos de dois tipos: o modo de inicialização, ou seja, a maneira como o fluxo deve ser iniciado; e o <code>NotificationRegister</code>, que contém o token do Firebase Cloud Message da usuária logada para que seja registrado no serviço de notificações. Os modos de inicialização que podem ser escolhidos são:</p><p><code>StartingApp</code> - Inicia todo o fluxo de autenticação e checkagem de KYC.</p><p><code>AccountSelectionRequest</code> - Exibe a tela de troca de conta e lida com a escolha da usuária.</p><p><code>PushNotificationReceived</code> - Deve ser iniciado ao receber uma notificação de abertura de conta referente ao processo de abertura de conta.</p><p><code>NewAccountCreated</code> - Chamado de verificação de pendência a cada conta aberta pelo app/sistema.</p><p>Este método executa os fluxos internos de autenticação e verificação de KYC. Quando o processo é finalizado, a <code>conta-stone-sdk</code> retorna um resultado que será tratado pelo app.</p><h4 id=lidando-com-o-resultado-da-sdk>Lidando com o resultado da sdk</h4><p>Ao finalizar o fluxo de autenticação e verificação a SDK emite um resultado para o app informando o desfecho do fluxo. Segue abaixo um exemplo de como tratar o resultado emitido pela <code>conta-stone-sdk</code> e o que cada um significa:</p><pre><code class=language-json5 data-lang=json5>  override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
        super.onActivityResult(requestCode, resultCode, data)

        when (requestCode) {
            AUTH_AND_VERIFICATION_RC -&amp;gt; {
                val result = contaStone.parseAuthAndVerificationResult(data)

                when (result) {
                    is AuthAndVerificationResult.Ok -&amp;gt; toast(&quot;Success&quot;)
                    is AuthAndVerificationResult.MissingData -&amp;gt; toast(&quot;Some error occur while reading data&quot;)
                    is AuthAndVerificationResult.UserCancelled -&amp;gt; toast(&quot;User cancelled flow&quot;)
                    is AuthAndVerificationResult.ReturnToPreviousScreen -&amp;gt; toast(&quot;Returned to the previous screen and was logged out&quot;)
                    is AuthAndVerificationResult.UserLoggedOut -&amp;gt; toast(&quot;User logged out&quot;)
                    is AuthAndVerificationResult.BlockedUser -&amp;gt; toast(&quot;This user is blocked&quot;)
                    is AuthAndVerificationResult.Error -&amp;gt; toast(&quot;Some error occur during auth and check flow)
                }
            }
        }
    }
</code></pre><h4 id=como-fazer-logout-da-usuária>Como fazer logout da usuária</h4><p>Como mencionado anteriormente, a <code>conta-stone-sdk</code> se comunica com a sdk de autenticação, que pode ser acessada pelo método <code>contaStone.auth()</code> e permite acesso aos métodos da interface da authSdk, como o método de logout. Confira abaixo um exemplo de como isso funciona:</p><pre><code class=language-json5 data-lang=json5>contaStone.auth().logout { exception: AuthFlowException? -&amp;gt;
                        exception?.let { toast(&quot; Success &quot;)} ?: toast(&quot;Erro during logout&quot;)
                    }
</code></pre><p>Quando a resposta é nula, o logout ocorreu com sucesso. Quando não, algum erro ocorreu durante o fluxo.</p><h4 id=cliente-autenticado>Cliente autenticado</h4><p>A authSDK é responsável por todo o processo de autenticação, incluindo a adição do token no header das chamadas até a api do Stone Openbank. Para realizar tudo isso, a SDK cria um client e adiciona um interceptor, o qual recupera o token do storage e o adiciona no header da chamada.</p><p>Esse client possui certificate pinning com os certificados da api do Stone OpenBank e é possível acessá-lo chamando o método <code>contaStone.auth().client()</code>, o qual retorna um <code>OkHttpClient</code> e pode ser utilizado nas chamadas HTTP do seu app.</p></div><nav class="pagination mt-3"><a class="nav nav-prev" href=https://stone-co.github.io/sdks/><i class="ti-arrow-left mr-2"></i><span class="d-none d-md-block">SDKs</span></a>
<a class="nav nav-next" href=https://stone-co.github.io/sdks/elixir/><span class="d-none d-md-block">Elixir</span><i class="ti-arrow-right ml-2"></i></a></nav></div></div></div></div></section><footer class="section pb-4"><div class=container><div class="row align-items-center"><div class="col-md-8 text-md-left text-center"><p class="mb-md-0 mb-4"></p></div><div class="col-md-4 text-md-right text-center"><ul class=list-inline><li class=list-inline-item><a class="text-color d-inline-block p-2" href=#><i class=ti-world></i></a></li><li class=list-inline-item><a class="text-color d-inline-block p-2" href=https://github.com/stone-co/go-stone-openbank><i class=ti-github></i></a></li></ul></div></div></div></footer><script src=https://stone-co.github.io/js/script.min.js></script></body></html>